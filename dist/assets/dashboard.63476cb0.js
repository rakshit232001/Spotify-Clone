import"./style.c0ed6924.js";import{A as C,E as P,T as w,l as q,S as f,g as A,a as h,s as _,L as b}from"./common.7260f892.js";const M="https://api.spotify.com/v1",H=()=>{const t=localStorage.getItem(C),e=localStorage.getItem(P),o=localStorage.getItem(w);if(Date.now()<e)return{accessToken:t,tokenType:o};q()},N=({accessToken:t,tokenType:e},o="GET")=>({headers:{Authorization:`${e} ${t}`},method:o}),L=async t=>{const e=`${M}/${t}`;return(await fetch(e,N(H()))).json()};let E;const a=new Audio,D=t=>{t.stopPropagation();const e=document.querySelector("#profile-menu");e.classList.toggle("hidden"),e.classList.contains("hidden")||e.querySelector("li#logout").addEventListener("click",q)},F=()=>new Promise(async(t,e)=>{const o=document.querySelector("#default-image"),c=document.querySelector("#user-profile-btn"),s=document.querySelector("#display-name"),{display_name:n,images:r}=await L(h.userInfo);r!=null&&r.length?o.classList.add("hidden"):o.classList.remove("hidden"),c.addEventListener("click",D),s.textContent=n,t({displayName:n,images:r})}),j=(t,e)=>{console.log(t.target);const o={type:f.PLAYLIST,playlist:e};history.pushState(o,"",`playlist/${e}`),x(o)},v=async(t,e)=>{const{playlists:{items:o}}=await L(t),c=document.querySelector(`#${e}`);for(let{name:s,description:n,images:r,id:i}of o){const l=document.createElement("section");l.className="bg-black-secondary rounded p-4 hover:cursor-pointer hover:bg-light-black",l.id=i,l.setAttribute("data-type","playlist"),l.addEventListener("click",d=>j(d,i));const[{url:m}]=r;l.innerHTML=`<img src="${m}" alt="${s}" class="rounded mb-2 object-contain shadow" />
            <h2 class="text-base font-semibold mb-4 truncate">${s}</h2>
            <h3 class="text-sm text-secondary line-clamp-2">${n}</h3>`,c.appendChild(l)}},B=()=>{v(h.featuredPlayist,"featured-playlist-items"),v(h.toplists,"top-playlist-items")},O=()=>{const t=document.querySelector("#cover-content");t.innerHTML=`<h1 class="text-8xl">Hello ${E}</h1>`;const e=document.querySelector("#page-content"),o=new Map([["featured","featured-playlist-items"],["top playlists","top-playlist-items"]]);let c="";for(let[s,n]of o)c+=`
        <article class="p-4">
          <h1 class="mb-4 text-2xl font-bold capitalize">${s}</h1>
          <section id="${n}" class="featured-songs grid grid-cols-auto-fill-cards gap-4">
           
          </section>
        </article>
        `;e.innerHTML=c},R=t=>{const e=Math.floor(t/6e4),o=(t%6e3/1e3).toFixed(0);return o==60?e+1+":00":e+":"+(o<10?"0":"")+o},Y=(t,e)=>{document.querySelectorAll("#tracks .track").forEach(o=>{o.id===t?o.classList.add("bg-gray","selected"):o.classList.remove("bg-gray","selected")})},U=()=>{const t=document.querySelector("#total-song-duration");t.textContent=`0:${a.duration.toFixed(0)}`},z=t=>{const e=document.querySelector("#play");e.querySelector("span").textContent="play_circle";const o=document.querySelector(`#play-track-${t}`);o&&(o.textContent="play_arrow")},K=t=>{const e=document.querySelector("#play");e.querySelector("span").textContent="pause_circle";const o=document.querySelector(`#play-track-${t}`);o&&(o.textContent="pause")},k=(t,{image:e,artistNames:o,name:c,duration:s,previewUrl:n,id:r})=>{t!=null&&t.stopPropagation&&t.stopPropagation(),console.log(e,o,c,s,n,r),a.src===n?$():(X({image:e,id:r,name:c,artistNames:o}),a.src=n,a.play())},X=({image:t,id:e,name:o,artistNames:c})=>{const s=document.querySelector("#audio-control"),n=document.querySelector("#now-playing-song"),r=document.querySelector("#now-playing-image"),i=document.querySelector("#now-playing-artists"),l=document.querySelector("#song-info");r.src=t.url,s.setAttribute("data-track-id",e),n.textContent=o,i.textContent=c,l.classList.remove("invisible")},G=({tracks:t})=>{const e=document.querySelector("#tracks");let o=1;const c=[];for(let s of t.items.filter(n=>n.track.preview_url)){let{id:n,artists:r,name:i,album:l,duration_ms:m,preview_url:d}=s.track,u=document.createElement("section");u.id=n,u.className="track p-1 grid grid-cols-[50px_1fr_1fr_50px] items-center justify-items-start gap-4 rounded-md hover:bg-light-black";let p=l.images.find(g=>g.height===64),y=Array.from(r,g=>g.name).join(", ");u.innerHTML=`
        <p class="relative w-full flex items-center justify-center justify-self-center"><span class="track-no">${o++}</span></p>
              <section class="grid grid-cols-[auto_1fr] place-items-center gap-2">
                <img class="h-10 w-10" src="${p.url}" alt="${i}" />
                <article class="flex flex-col gap-2 justify-center">
                  <h2 class="text-base text-primary line-clamp-1 song-title">${i}</h2>
                  <p class="text-xs line-clamp-1">${y}</p>
                </article>
              </section>
              <p class="text-sm">${l.name}</p>
              <p class="text-sm">${R(m)}</p>
        `,u.addEventListener("click",g=>Y(n));const S=document.createElement("button");S.id=`play-track-${n}`,S.className="play w-full absolute left-0 text-lg invisible material-symbols-outlined",S.textContent="play_arrow",S.addEventListener("click",g=>k(g,{image:p,artistNames:y,name:i,duration:m,previewUrl:d,id:n})),u.querySelector("p").appendChild(S),e.appendChild(u),c.push({id:n,artists:r,name:i,album:l,duration:m,previewUrl:d,artistNames:y,image:p})}_(b,c)},W=async t=>{const e=await L(`${h.playlist}/${t}`);console.log(e);const{name:o,description:c,images:s,tracks:n}=e,r=document.querySelector("#cover-content");r.innerHTML=`
        <img  class="object-contain" src="${s[0].url}" alt="${o}" />
        <section class="flex flex-col justify-center">
          <h2 id="playlist-name" class="text-8xl font-bold">${o}</h2>
          <p id="playlist-details" class="text-2xl">${c} songs</p>
          <p id="playlist-details" class="text-base">${n.items.length} songs</p>
        </section>
    `;const i=document.querySelector("#page-content");i.innerHTML=`
    <header id="playlist-header" class="mx-8 border-secondary border-b-[0.5px] z-10">
            <nav class="py-2">
              <ul class="grid grid-cols-[50px_1fr_1fr_50px] gap-4 text-secondary">
                <li class="justify-self-center">#</li>
                <li>Title</li>
                <li>Album</li>
                <li class="material-symbols-outlined">schedule</li>
              </ul>
            </nav>
    </header>
    <section class="px-8 text-secondary mt-4" id="tracks">
    </section>
    `,console.log(e),G(e)},T=t=>{const{scrollTop:e}=t.target,o=document.querySelector(".header"),c=document.querySelector("#cover-content"),s=c.offsetHeight,n=s/2,r=100-(e>=s?100:e/s*100);c.style.opacity=`${r}%`;let i=0;if(e>=n&&e<=s){let l=s-n;i=(e-n)/l*100}else e>s?i=100:e<n&&(i=0);if(o.style.background=`rgba(0 0 0 / ${i}%)`,history.state.type===f.PLAYLIST){const l=document.querySelector("#playlist-header");i>=60?(l.classList.add("sticky","bg-black-secondary","px-8"),l.classList.remove("mx-8"),l.style.top=`${o.offsetHeight}px`):(l.classList.remove("sticky","bg-black-secondary","px-8"),l.classList.add("mx-8"),l.style.top="revert")}},$=()=>{a.src&&(a.paused?a.play():a.pause())},I=()=>{const e=document.querySelector("#audio-control").getAttribute("data-track-id");if(e){const o=A(b);return{currentTrackIndex:o==null?void 0:o.findIndex(s=>s.id===e),tracks:o}}return null},J=()=>{var o;const{currentTrackIndex:t=-1,tracks:e=null}=(o=I())!=null?o:{};if(t>0){const c=e[t-1];k(null,c)}},Q=()=>{var o;const{currentTrackIndex:t=-1,tracks:e=null}=(o=I())!=null?o:{};if(t>-1&&t<(e==null?void 0:e.length)-1){const c=e[t+1];k(null,c)}},x=t=>{t.type===f.DASHBOARD?(O(),B()):t.type===f.PLAYLIST&&W(t.playlist),document.querySelector(".content").removeEventListener("scroll",T),document.querySelector(".content").addEventListener("scroll",T)},V=t=>{const e={type:f.PLAYLIST,playlist:t};history.pushState(e,"",`/playlist/${t}`),x(e)},Z=async()=>{const t=await L(h.userPlaylist);console.log(t);const e=document.querySelector("#user-playlists >ul");e.innerHTML="";for(let{name:o,id:c}of t.items){const s=document.createElement("li");s.textContent=o,s.className="cursor-pointer hover:text-primary ",s.addEventListener("click",()=>V(c)),e.appendChild(s)}};document.addEventListener("DOMContentLoaded",async()=>{const t=document.querySelector("#volume"),e=document.querySelector("#play"),o=document.querySelector("#next"),c=document.querySelector("#prev"),s=document.querySelector("#song-duration-completed"),n=document.querySelector("#progress"),r=document.querySelector("#timeline"),i=document.querySelector("#audio-control");let l;({displayName:E}=await F()),Z();const m={type:f.DASHBOARD};history.pushState(m,"",""),x(m),document.addEventListener("click",()=>{const d=document.querySelector("#profile-menu");d.classList.contains("hidden")||d.classList.add("hidden")}),a.addEventListener("loadedmetadata",U),a.addEventListener("play",()=>{const d=i.getAttribute("data-track-id"),u=document.querySelector("#tracks"),p=u==null?void 0:u.querySelector("section.playing"),y=u==null?void 0:u.querySelector(`[id="${d}"]`);(p==null?void 0:p.id)!==(y==null?void 0:y.id)&&(p==null||p.classList.remove("playing")),y==null||y.classList.add("playing"),l=setInterval(()=>{a.paused||(s.textContent=`${a.currentTime.toFixed(0)<10?"0:0"+a.currentTime.toFixed(0):"0:"+a.currentTime.toFixed(0)}`,n.style.width=`${a.currentTime/a.duration*100}%`)},100),K(d)}),a.addEventListener("pause",()=>{l&&clearInterval();const d=i.getAttribute("data-track-id");z(d)}),t.addEventListener("change",()=>{a.volume=t.value/100}),r.addEventListener("click",d=>{const u=window.getComputedStyle(r).width,p=d.offsetX/parseInt(u)*a.duration;a.currentTime=p,n.style.width=`${a.currentTime/a.duration*100}%`},!1),e.addEventListener("click",$),c.addEventListener("click",J),o.addEventListener("click",Q),window.addEventListener("popstate",d=>{console.log(d),x(d.state)})});
